<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Monitoring Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.2.0/tf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #718096;
            font-size: 1.1em;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
        }

        .input-section {
            grid-column: span 2;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .input-group input {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .anomaly-alert {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin: 15px 0;
            display: none;
            animation: pulse 2s infinite;
        }

        .anomaly-alert.show {
            display: block;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .prediction-card {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .prediction-card h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                grid-column: span 1;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Health Monitoring Dashboard</h1>
            <p>AI-Powered Health Analytics with Anomaly Detection</p>
        </div>

        <div class="input-section">
            <h3>üìä Add Health Metrics</h3>
            <div class="input-grid">
                <div class="input-group">
                    <label for="heartRate">Heart Rate (BPM)</label>
                    <input type="number" id="heartRate" placeholder="70" min="40" max="200">
                </div>
                <div class="input-group">
                    <label for="bloodPressureSys">Systolic BP</label>
                    <input type="number" id="bloodPressureSys" placeholder="120" min="80" max="200">
                </div>
                <div class="input-group">
                    <label for="bloodPressureDia">Diastolic BP</label>
                    <input type="number" id="bloodPressureDia" placeholder="80" min="50" max="120">
                </div>
                <div class="input-group">
                    <label for="weight">Weight (kg)</label>
                    <input type="number" id="weight" placeholder="70" min="30" max="200" step="0.1">
                </div>
                <div class="input-group">
                    <label for="steps">Daily Steps</label>
                    <input type="number" id="steps" placeholder="8000" min="0" max="50000">
                </div>
                <div class="input-group">
                    <label for="sleep">Sleep Hours</label>
                    <input type="number" id="sleep" placeholder="8" min="0" max="24" step="0.5">
                </div>
            </div>
            <button class="btn" onclick="addHealthData()">üìà Add Data & Analyze</button>
            <button class="btn" onclick="generateSampleData()" style="margin-left: 10px; background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);">üéØ Generate Sample Data</button>
        </div>

        <div id="anomalyAlert" class="anomaly-alert">
            <strong>‚ö†Ô∏è Anomaly Detected!</strong> <span id="anomalyMessage"></span>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h3>üíì Heart Rate Trends</h3>
                <div class="chart-container">
                    <canvas id="heartRateChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>ü©∏ Blood Pressure Monitor</h3>
                <div class="chart-container">
                    <canvas id="bloodPressureChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>‚öñÔ∏è Weight & Activity Tracking</h3>
                <div class="chart-container">
                    <canvas id="weightStepsChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>üò¥ Sleep Quality Analysis</h3>
                <div class="chart-container">
                    <canvas id="sleepChart"></canvas>
                </div>
                <div class="prediction-card">
                    <h4>üîÆ Health Predictions</h4>
                    <p id="healthPrediction">Add more data to see AI predictions...</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>üìà Health Statistics Overview</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="avgHeartRate">--</div>
                    <div class="stat-label">Avg Heart Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgBP">--</div>
                    <div class="stat-label">Avg Blood Pressure</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalSteps">--</div>
                    <div class="stat-label">Total Steps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgSleep">--</div>
                    <div class="stat-label">Avg Sleep</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="anomaliesDetected">0</div>
                    <div class="stat-label">Anomalies Detected</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Health data storage
        let healthData = {
            dates: [],
            heartRate: [],
            systolic: [],
            diastolic: [],
            weight: [],
            steps: [],
            sleep: []
        };

        let anomalyCount = 0;
        let charts = {};

        // TensorFlow model for anomaly detection
        let anomalyModel;

        // Initialize TensorFlow model
        async function initializeAnomalyModel() {
            // Create a simple autoencoder for anomaly detection
            anomalyModel = tf.sequential({
                layers: [
                    tf.layers.dense({ inputShape: [6], units: 4, activation: 'relu' }),
                    tf.layers.dense({ units: 2, activation: 'relu' }),
                    tf.layers.dense({ units: 4, activation: 'relu' }),
                    tf.layers.dense({ units: 6, activation: 'linear' })
                ]
            });

            anomalyModel.compile({
                optimizer: tf.train.adam(0.001),
                loss: 'meanSquaredError'
            });

            console.log('Anomaly detection model initialized');
        }

        // Initialize charts
        function initializeCharts() {
            // Heart Rate Chart
            const heartRateCtx = document.getElementById('heartRateChart').getContext('2d');
            charts.heartRate = new Chart(heartRateCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Heart Rate (BPM)',
                        data: [],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 50,
                            max: 150
                        }
                    }
                }
            });

            // Blood Pressure Chart
            const bpCtx = document.getElementById('bloodPressureChart').getContext('2d');
            charts.bloodPressure = new Chart(bpCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Systolic',
                        data: [],
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        borderWidth: 3,
                        fill: false
                    }, {
                        label: 'Diastolic',
                        data: [],
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        borderWidth: 3,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 60,
                            max: 180
                        }
                    }
                }
            });

            // Weight & Steps Chart
            const weightStepsCtx = document.getElementById('weightStepsChart').getContext('2d');
            charts.weightSteps = new Chart(weightStepsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Weight (kg)',
                        data: [],
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y',
                        fill: true
                    }, {
                        label: 'Steps (thousands)',
                        data: [],
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y1',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });

            // Sleep Chart
            const sleepCtx = document.getElementById('sleepChart').getContext('2d');
            charts.sleep = new Chart(sleepCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Sleep Hours',
                        data: [],
                        backgroundColor: 'rgba(78, 205, 196, 0.8)',
                        borderColor: '#4ecdc4',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 12
                        }
                    }
                }
            });
        }

        // Add health data
        function addHealthData() {
            const heartRate = parseFloat(document.getElementById('heartRate').value);
            const systolic = parseFloat(document.getElementById('bloodPressureSys').value);
            const diastolic = parseFloat(document.getElementById('bloodPressureDia').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const steps = parseFloat(document.getElementById('steps').value);
            const sleep = parseFloat(document.getElementById('sleep').value);

            if (!heartRate || !systolic || !diastolic || !weight || !steps || !sleep) {
                alert('Please fill in all health metrics!');
                return;
            }

            // Add data to storage
            const now = new Date();
            const dateString = now.toLocaleDateString();
            
            healthData.dates.push(dateString);
            healthData.heartRate.push(heartRate);
            healthData.systolic.push(systolic);
            healthData.diastolic.push(diastolic);
            healthData.weight.push(weight);
            healthData.steps.push(steps);
            healthData.sleep.push(sleep);

            // Keep only last 30 entries
            if (healthData.dates.length > 30) {
                Object.keys(healthData).forEach(key => {
                    healthData[key] = healthData[key].slice(-30);
                });
            }

            // Clear inputs
            document.getElementById('heartRate').value = '';
            document.getElementById('bloodPressureSys').value = '';
            document.getElementById('bloodPressureDia').value = '';
            document.getElementById('weight').value = '';
            document.getElementById('steps').value = '';
            document.getElementById('sleep').value = '';

            // Update charts and run anomaly detection
            updateCharts();
            detectAnomalies();
            updateStatistics();
            generateHealthPredictions();
        }

        // Update all charts
        function updateCharts() {
            // Heart Rate Chart
            charts.heartRate.data.labels = healthData.dates;
            charts.heartRate.data.datasets[0].data = healthData.heartRate;
            charts.heartRate.update();

            // Blood Pressure Chart
            charts.bloodPressure.data.labels = healthData.dates;
            charts.bloodPressure.data.datasets[0].data = healthData.systolic;
            charts.bloodPressure.data.datasets[1].data = healthData.diastolic;
            charts.bloodPressure.update();

            // Weight & Steps Chart
            charts.weightSteps.data.labels = healthData.dates;
            charts.weightSteps.data.datasets[0].data = healthData.weight;
            charts.weightSteps.data.datasets[1].data = healthData.steps.map(s => s / 1000); // Convert to thousands
            charts.weightSteps.update();

            // Sleep Chart
            charts.sleep.data.labels = healthData.dates;
            charts.sleep.data.datasets[0].data = healthData.sleep;
            charts.sleep.update();
        }

        // Detect anomalies using statistical methods and TensorFlow
        async function detectAnomalies() {
            if (healthData.heartRate.length < 5) return;

            const latestData = [
                healthData.heartRate[healthData.heartRate.length - 1],
                healthData.systolic[healthData.systolic.length - 1],
                healthData.diastolic[healthData.diastolic.length - 1],
                healthData.weight[healthData.weight.length - 1],
                healthData.steps[healthData.steps.length - 1] / 10000, // Normalize steps
                healthData.sleep[healthData.sleep.length - 1]
            ];

            // Statistical anomaly detection
            let anomalies = [];

            // Heart rate anomaly (simple threshold)
            const hr = latestData[0];
            if (hr < 50 || hr > 120) {
                anomalies.push(`Unusual heart rate: ${hr} BPM`);
            }

            // Blood pressure anomaly
            const sys = latestData[1];
            const dia = latestData[2];
            if (sys > 140 || dia > 90) {
                anomalies.push(`High blood pressure: ${sys}/${dia} mmHg`);
            }

            // Sleep anomaly
            const sleepHours = latestData[5];
            if (sleepHours < 4 || sleepHours > 12) {
                anomalies.push(`Unusual sleep pattern: ${sleepHours} hours`);
            }

            // If we have enough data, train and use TensorFlow model
            if (healthData.heartRate.length >= 10) {
                await trainAnomalyModel();
                const isAnomaly = await detectTensorFlowAnomaly(latestData);
                if (isAnomaly) {
                    anomalies.push('there is an unusual health pattern');
                }
            }

            // Show anomaly alert
            if (anomalies.length > 0) {
                showAnomalyAlert(anomalies);
                anomalyCount++;
            } else {
                hideAnomalyAlert();
            }
        }

        // Train anomaly detection model
        async function trainAnomalyModel() {
            if (healthData.heartRate.length < 10) return;

            // Prepare training data (normalize)
            const trainingData = [];
            for (let i = 0; i < healthData.heartRate.length; i++) {
                trainingData.push([
                    healthData.heartRate[i] / 100, // Normalize
                    healthData.systolic[i] / 150,
                    healthData.diastolic[i] / 100,
                    healthData.weight[i] / 100,
                    healthData.steps[i] / 10000,
                    healthData.sleep[i] / 10
                ]);
            }

            const xs = tf.tensor2d(trainingData);
            
            // Train autoencoder (unsupervised learning)
            await anomalyModel.fit(xs, xs, {
                epochs: 50,
                batchSize: Math.min(8, trainingData.length),
                verbose: 0
            });

            xs.dispose();
        }

        // Detect anomaly using TensorFlow model
        async function detectTensorFlowAnomaly(data) {
            const normalizedData = [
                data[0] / 100,
                data[1] / 150,
                data[2] / 100,
                data[3] / 100,
                data[4], // Already normalized
                data[5] / 10
            ];

            const input = tf.tensor2d([normalizedData]);
            const prediction = anomalyModel.predict(input);
            const reconstruction = await prediction.data();
            
            // Calculate reconstruction error
            let error = 0;
            for (let i = 0; i < normalizedData.length; i++) {
                error += Math.pow(normalizedData[i] - reconstruction[i], 2);
            }
            
            input.dispose();
            prediction.dispose();
            
            // Threshold for anomaly detection
            return error > 0.1;
        }

        // Show anomaly alert
        function showAnomalyAlert(anomalies) {
            const alertDiv = document.getElementById('anomalyAlert');
            const messageSpan = document.getElementById('anomalyMessage');
            messageSpan.textContent = anomalies.join('; ');
            alertDiv.classList.add('show');
        }

        // Hide anomaly alert
        function hideAnomalyAlert() {
            const alertDiv = document.getElementById('anomalyAlert');
            alertDiv.classList.remove('show');
        }

        // Update statistics
        function updateStatistics() {
            if (healthData.heartRate.length === 0) return;

            // Average heart rate
            const avgHR = (healthData.heartRate.reduce((a, b) => a + b, 0) / healthData.heartRate.length).toFixed(0);
            document.getElementById('avgHeartRate').textContent = avgHR;

            // Average blood pressure
            const avgSys = (healthData.systolic.reduce((a, b) => a + b, 0) / healthData.systolic.length).toFixed(0);
            const avgDia = (healthData.diastolic.reduce((a, b) => a + b, 0) / healthData.diastolic.length).toFixed(0);
            document.getElementById('avgBP').textContent = `${avgSys}/${avgDia}`;

            // Total steps
            const totalSteps = healthData.steps.reduce((a, b) => a + b, 0);
            document.getElementById('totalSteps').textContent = (totalSteps / 1000).toFixed(0) + 'K';

            // Average sleep
            const avgSleep = (healthData.sleep.reduce((a, b) => a + b, 0) / healthData.sleep.length).toFixed(1);
            document.getElementById('avgSleep').textContent = avgSleep + 'h';

            // Anomalies detected
            document.getElementById('anomaliesDetected').textContent = anomalyCount;
        }

        // Generate health predictions
        function generateHealthPredictions() {
            if (healthData.heartRate.length < 5) {
                document.getElementById('healthPrediction').textContent = 'Add more data to see AI predictions...';
                return;
            }

            // Simple trend analysis
            const recentHR = healthData.heartRate.slice(-5);
            const recentWeight = healthData.weight.slice(-5);
            const recentSleep = healthData.sleep.slice(-5);

            let predictions = [];

            // Heart rate trend
            const hrTrend = (recentHR[recentHR.length - 1] - recentHR[0]) / recentHR.length;
            if (hrTrend > 2) {
                predictions.push('Heart rate trending upward - consider rest');
            } else if (hrTrend < -2) {
                predictions.push('Heart rate improving - keep it up!');
            }

            // Weight trend
            const weightTrend = (recentWeight[recentWeight.length - 1] - recentWeight[0]) / recentWeight.length;
            if (Math.abs(weightTrend) > 0.5) {
                predictions.push(weightTrend > 0 ? 'Weight increasing trend detected' : 'Weight decreasing trend detected');
            }

            // Sleep quality
            const avgRecentSleep = recentSleep.reduce((a, b) => a + b, 0) / recentSleep.length;
            if (avgRecentSleep < 6) {
                predictions.push('Consider improving sleep schedule');
            } else if (avgRecentSleep > 8) {
                predictions.push('Excellent sleep patterns detected!');
            }

            if (predictions.length === 0) {
                predictions.push('All metrics appear stable and healthy!');
            }

            document.getElementById('healthPrediction').textContent = predictions.join('. ');
        }

        // Generate sample data for demonstration
        function generateSampleData() {
            // Clear existing data
            healthData = {
                dates: [],
                heartRate: [],
                systolic: [],
                diastolic: [],
                weight: [],
                steps: [],
                sleep: []
            };

            // Generate 14 days of sample data
            const baseDate = new Date();
            baseDate.setDate(baseDate.getDate() - 14);

            for (let i = 0; i < 14; i++) {
                const currentDate = new Date(baseDate);
                currentDate.setDate(currentDate.getDate() + i);
                
                healthData.dates.push(currentDate.toLocaleDateString());
                
                // Generate realistic health data with some variation
                healthData.heartRate.push(65 + Math.random() * 20 + (i > 10 ? Math.random() * 15 : 0)); // Slight increase later
                healthData.systolic.push(110 + Math.random() * 20 + (Math.random() > 0.9 ? 20 : 0)); // Occasional spike
                healthData.diastolic.push(70 + Math.random() * 15);
                healthData.weight.push(70 + Math.sin(i * 0.3) * 2 + Math.random() * 1);
                healthData.steps.push(6000 + Math.random() * 6000);
                healthData.sleep.push(6.5 + Math.random() * 3 + (Math.random() > 0.8 ? -2 : 0)); // Occasional poor sleep
            }

            updateCharts();
            detectAnomalies();
            updateStatistics();
            generateHealthPredictions();
            
            alert('Sample health data generated! The AI will now analyze patterns and detect anomalies.');
        }

        // Initialize everything when page loads
        window.addEventListener('load', async () => {
            await initializeAnomalyModel();
            initializeCharts();
        });
    </script>
</body>
</html>